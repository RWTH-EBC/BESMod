stages:    - RegressionTest    - Ref_Check    - plot_ref    - prepare.CI_Regressiontest:    stage: RegressionTest    before_script:        - git clone https://github.com/RWTH-EBC/MoCITempGen        - export PIP_CACHE_DIR="/opt/cache/pip"        - source activate myenv        - pip install --upgrade git+https://github.com/MichaMans/BuildingsPy@testexamplescoverage        - export PYTHONIOENCODING=utf-8    script:        - cd BESMod && xvfb-run -n 77 python MoCITempGen/CITests/UnitTests/reference_check.py -n 4 --tool dymola --single-package "$lib_package" --library BESMod --batch -DS 2022    after_script:        - if cat dymola-ci-tests/Configfiles/exit.sh | grep "FAIL"; then            export PIP_CACHE_DIR="/opt/cache/pip" ;            source activate myenv ;            pip install pandas mako matplot ;            mkdir -p data ;            mkdir -p data/plots ;            cp -r BESMod/simulator-dymola.log data ;            cp -r BESMod/unitTests-dymola.log data ;            cp -r BESMod/funnel_comp data ;            python MoCITempGen/CITests/Converter/google_charts.py --line-html --error --funnel-comp --single-package $lib_package ;            cp -r dymola-ci-tests/charts/$lib_package data/plots/$lib_package ;          else            echo "Test was successful!" ;          fi    artifacts:        when: on_failure        paths:          - data        expire_in: 7h    only:        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/    except:        refs:            - external_pull_requests    retry:        max: 2        when: runner_system_failureCI_Regressiontest_BESMod_Examples:    variables:        lib_package: BESMod.Examples    extends: .CI_RegressiontestCI_Regressiontest_BESMod_Systems:    variables:        lib_package: BESMod.Systems    extends: .CI_RegressiontestCI_Regressiontest_BESMod_Tutorial:    variables:        lib_package: BESMod.Tutorial    extends: .CI_RegressiontestCI_Regressiontest_BESMod_Utilities:    variables:        lib_package: BESMod.Utilities    extends: .CI_Regressiontest.dev_Regressiontest:    stage: RegressionTest    before_script:        - export PIP_CACHE_DIR="/opt/cache/pip"        - source activate myenv        - pip install --upgrade git+https://github.com/MichaMans/BuildingsPy@testexamplescoverage        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - cd BESMod && xvfb-run -n 77 python MoCITempGen/CITests/UnitTests/reference_check.py -n 4 --tool dymola --single-package "$lib_package" --library BESMod --batch -DS 2022    after_script:        - if cat dymola-ci-tests/Configfiles/exit.sh | grep "FAIL"; then            export PIP_CACHE_DIR="/opt/cache/pip" ;            source activate myenv ;            pip install pandas mako matplot ;            mkdir -p data ;            mkdir -p data/plots ;            cp -r BESMod/simulator-dymola.log data ;            cp -r BESMod/unitTests-dymola.log data ;            cp -r BESMod/funnel_comp data ;            python MoCITempGen/CITests/Converter/google_charts.py --line-html --error --funnel-comp --single-package $lib_package ;            cp -r dymola-ci-tests/charts/$lib_package data/plots/$lib_package ;          else            echo "Test was successful!" ;          fi    artifacts:        when: on_failure        paths:          - data        expire_in: 7h    only:        refs:            - main    retry:        max: 2        when: runner_system_failureDevelopment_Regressiontest_BESMod_Examples:    variables:        lib_package: BESMod.Examples    extends: .dev_RegressiontestDevelopment_Regressiontest_BESMod_Systems:    variables:        lib_package: BESMod.Systems    extends: .dev_RegressiontestDevelopment_Regressiontest_BESMod_Tutorial:    variables:        lib_package: BESMod.Tutorial    extends: .dev_RegressiontestDevelopment_Regressiontest_BESMod_Utilities:    variables:        lib_package: BESMod.Utilities    extends: .dev_RegressiontestCI_create_plots:    stage: prepare    before_script:        - source activate myenv        - pip install --upgrade pip &&  apt-get update -y && apt-get install zip unzip -y        - pip install pandas mako matplot toml requests        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - mkdir -p $CI_COMMIT_REF_NAME/plots        - python MoCITempGen/CITests/Converter/google_charts.py  --create-layout --library BESMod --single-package BESMod        - cp -r data/plots/*  $CI_COMMIT_REF_NAME/plots        - python MoCITempGen/CITests/api_script/api_github.py  --working-branch $CI_COMMIT_REF_NAME --github-repo $Github_Repository --gitlab-page $GITLAB_Page --github-token $GITHUB_API_TOKEN --post-pr-comment --prepare-plot    artifacts:        paths:         - $CI_COMMIT_REF_NAME/plots    only:        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/    except:        refs:            - external_pull_requests    when: on_failure    needs:    - job: CI_Regressiontest_BESMod_Examples      artifacts: true    - job: CI_Regressiontest_BESMod_Systems      artifacts: true    - job: CI_Regressiontest_BESMod_Tutorial      artifacts: true    - job: CI_Regressiontest_BESMod_Utilities      artifacts: true.Regressiontest_job:    stage: RegressionTest    before_script:        - export PIP_CACHE_DIR="/opt/cache/pip"        - source activate myenv        - pip install --upgrade git+https://github.com/MichaMans/BuildingsPy@testexamplescoverage        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - cd BESMod && xvfb-run -n 77 python MoCITempGen/CITests/UnitTests/reference_check.py -n 4 --tool dymola --single-package "$lib_package" --library BESMod --batch -DS 2022    after_script:        - if cat dymola-ci-tests/Configfiles/exit.sh | grep "FAIL"; then            export PIP_CACHE_DIR="/opt/cache/pip" ;            source activate myenv ;            pip install pandas mako matplot ;            mkdir -p data ;            mkdir -p data/plots ;            cp -r BESMod/simulator-dymola.log data ;            cp -r BESMod/unitTests-dymola.log data ;            cp -r BESMod/funnel_comp data ;            python MoCITempGen/CITests/Converter/google_charts.py --line-html --error --funnel-comp --single-package $lib_package ;            cp -r dymola-ci-tests/charts/$lib_package data/plots/$lib_package ;          else            echo "Test was successful!" ;          fi    artifacts:        when: on_failure        paths:          - data        expire_in: 7h    only:        refs:            - external_pull_requests    except:        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_show_ref/            - $CI_COMMIT_MESSAGE  =~ /ci_create_model_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_html_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_example_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_simulate/            - $CI_COMMIT_MESSAGE  =~ /ci_check/            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/            - $CI_COMMIT_MESSAGE  =~ /ci_html/            - $CI_COMMIT_MESSAGE  =~ /ci_setting/            - $CI_COMMIT_MESSAGE  =~ /ci_style_check/            - $CI_COMMIT_MESSAGE  =~ /ci_trigger_ibpsa/            - $CI_COMMIT_MESSAGE  =~ /ci_merge_except/            - $CI_COMMIT_MESSAGE  =~ /ci_correct_html/            - $CI_COMMIT_MESSAGE  =~ /ci_build_structure/            - $CI_COMMIT_MESSAGE  =~ /ci_build_whitelist/        refs:            - main    retry:        max: 2        when: runner_system_failureRegressiontest_BESMod_Examples:    variables:        lib_package: BESMod.Examples    extends: .Regressiontest_jobRegressiontest_BESMod_Systems:    variables:        lib_package: BESMod.Systems    extends: .Regressiontest_jobRegressiontest_BESMod_Tutorial:    variables:        lib_package: BESMod.Tutorial    extends: .Regressiontest_jobRegressiontest_BESMod_Utilities:    variables:        lib_package: BESMod.Utilities    extends: .Regressiontest_jobRegression_overall_coverage:    stage: RegressionTest    before_script:        - export PIP_CACHE_DIR="/opt/cache/pip"        - source activate myenv        - pip install --upgrade git+https://github.com/MichaMans/BuildingsPy@testexamplescoverage        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - cd BESMod && xvfb-run -n 77 python MoCITempGen/CITests/UnitTests/reference_check.py --coverage-only    artifacts:        when: on_failure        paths:            - BESMod/simulator-dymola.log            - BESMod/unitTests-dymola.log        expire_in: 7h    only:        refs:            - external_pull_requests    except:        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_show_ref/            - $CI_COMMIT_MESSAGE  =~ /ci_create_model_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_html_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_example_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_simulate/            - $CI_COMMIT_MESSAGE  =~ /ci_check/            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/            - $CI_COMMIT_MESSAGE  =~ /ci_html/            - $CI_COMMIT_MESSAGE  =~ /ci_setting/            - $CI_COMMIT_MESSAGE  =~ /ci_style_check/            - $CI_COMMIT_MESSAGE  =~ /ci_trigger_ibpsa/            - $CI_COMMIT_MESSAGE  =~ /ci_merge_except/            - $CI_COMMIT_MESSAGE  =~ /ci_correct_html/            - $CI_COMMIT_MESSAGE  =~ /ci_build_structure/            - $CI_COMMIT_MESSAGE  =~ /ci_build_whitelist/        refs:            - main    retry:        max: 2        when: runner_system_failureprepare_create_plots:    stage: prepare    before_script:        - source activate myenv        - pip install --upgrade git+https://github.com/MichaMans/BuildingsPy@testexamplescoverage        - pip install --upgrade pip &&  apt-get update -y && apt-get install zip unzip -y        - pip install pandas mako matplot toml requests        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - mkdir -p $CI_COMMIT_REF_NAME/plots        - python MoCITempGen/CITests/Converter/google_charts.py  --create-layout --library BESMod --single-package BESMod        - cp -r data/plots/*  $CI_COMMIT_REF_NAME/plots        - python MoCITempGen/CITests/api_script/api_github.py  --working-branch $CI_COMMIT_REF_NAME --github-repo $Github_Repository --gitlab-page $GITLAB_Page --github-token $GITHUB_API_TOKEN --post-pr-comment --prepare-plot    artifacts:        paths:         - $CI_COMMIT_REF_NAME/plots    only:        refs:            - external_pull_requests    except:        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_show_ref/            - $CI_COMMIT_MESSAGE  =~ /ci_create_model_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_html_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_example_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_simulate/            - $CI_COMMIT_MESSAGE  =~ /ci_check/            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/            - $CI_COMMIT_MESSAGE  =~ /ci_html/            - $CI_COMMIT_MESSAGE  =~ /ci_setting/            - $CI_COMMIT_MESSAGE  =~ /ci_style_check/            - $CI_COMMIT_MESSAGE  =~ /ci_trigger_ibpsa/            - $CI_COMMIT_MESSAGE  =~ /ci_merge_except/            - $CI_COMMIT_MESSAGE  =~ /ci_correct_html/            - $CI_COMMIT_MESSAGE  =~ /ci_build_structure/            - $CI_COMMIT_MESSAGE  =~ /ci_build_whitelist/        refs:            - main    when: on_failure    needs:    - job: Regressiontest_BESMod_Examples      artifacts: true    - job: Regressiontest_BESMod_Systems      artifacts: true    - job: Regressiontest_BESMod_Tutorial      artifacts: true    - job: Regressiontest_BESMod_Utilities      artifacts: true.Regressiontest_changed_Job:    stage: RegressionTest    before_script:        - export PIP_CACHE_DIR="/opt/cache/pip"        - source activate myenv        - pip install --upgrade git+https://github.com/MichaMans/BuildingsPy@testexamplescoverage        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - python MoCITempGen/CITests/CI_Configuration/configuration.py --changed-model        - git diff --raw --diff-filter=AMT HEAD^1 > dymola-ci-tests/Configfiles/ci_changed_model_list.txt        - cd BESMod && xvfb-run -n 77 python MoCITempGen/CITests/UnitTests/reference_check.py -n 4 --tool dymola --single-package $lib_package --library BESMod --batch -DS 2022 -n 2 --modified-models    after_script:        - if cat dymola-ci-tests/Configfiles/exit.sh | grep "FAIL"; then            export PIP_CACHE_DIR="/opt/cache/pip";            source activate myenv;            pip install pandas mako matplot;            mkdir -p data ;            mkdir -p data/plots ;            cp -r BESMod/simulator-dymola.log data ;            cp -r BESMod/unitTests-dymola.log data ;            cp -r BESMod/funnel_comp data ;            python MoCITempGen/CITests/Converter/google_charts.py --line-html --error --funnel-comp --single-package $lib_package;            cp -r dymola-ci-tests/charts/$lib_package data/plots/$lib_package ;          else            echo "Test was successful!";          fi    artifacts:        when: on_failure        paths:            - data        expire_in: 7h    except:        refs:            - external_pull_requests            - None_Merge            - main            - /^correct_HTML_.*$/        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_show_ref/            - $CI_COMMIT_MESSAGE  =~ /ci_create_model_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_html_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_example_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_simulate/            - $CI_COMMIT_MESSAGE  =~ /ci_check/            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/            - $CI_COMMIT_MESSAGE  =~ /ci_html/            - $CI_COMMIT_MESSAGE  =~ /ci_setting/            - $CI_COMMIT_MESSAGE  =~ /ci_style_check/            - $CI_COMMIT_MESSAGE  =~ /ci_trigger_ibpsa/            - $CI_COMMIT_MESSAGE  =~ /ci_merge_except/            - $CI_COMMIT_MESSAGE  =~ /ci_correct_html/            - $CI_COMMIT_MESSAGE  =~ /ci_build_structure/            - $CI_COMMIT_MESSAGE  =~ /ci_build_whitelist/    only:            changes:            - BESMod/**/*    retry:        max: 2        when: runner_system_failureChanged_Regressiontest_BESMod_Examples:    variables:        lib_package: BESMod.Examples    extends: .Regressiontest_changed_JobChanged_Regressiontest_BESMod_Systems:    variables:        lib_package: BESMod.Systems    extends: .Regressiontest_changed_JobChanged_Regressiontest_BESMod_Tutorial:    variables:        lib_package: BESMod.Tutorial    extends: .Regressiontest_changed_JobChanged_Regressiontest_BESMod_Utilities:    variables:        lib_package: BESMod.Utilities    extends: .Regressiontest_changed_JobChanged_create_plots:    stage: prepare    before_script:        - source activate myenv        - pip install --upgrade pip &&  apt-get update -y && apt-get install zip unzip -y        - pip install pandas mako matplot requests toml        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - mkdir -p $CI_COMMIT_REF_NAME/plots        - python MoCITempGen/CITests/Converter/google_charts.py  --create-layout --library BESMod --single-package BESMod        - cp -r data/plots/*  $CI_COMMIT_REF_NAME/plots    artifacts:        paths:         - $CI_COMMIT_REF_NAME/plots    except:        refs:            - external_pull_requests            - None_Merge            - main            - /^correct_HTML_.*$/        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_show_ref/            - $CI_COMMIT_MESSAGE  =~ /ci_create_model_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_html_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_example_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_simulate/            - $CI_COMMIT_MESSAGE  =~ /ci_check/            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/            - $CI_COMMIT_MESSAGE  =~ /ci_html/            - $CI_COMMIT_MESSAGE  =~ /ci_setting/            - $CI_COMMIT_MESSAGE  =~ /ci_style_check/            - $CI_COMMIT_MESSAGE  =~ /ci_trigger_ibpsa/            - $CI_COMMIT_MESSAGE  =~ /ci_merge_except/            - $CI_COMMIT_MESSAGE  =~ /ci_correct_html/            - $CI_COMMIT_MESSAGE  =~ /ci_build_structure/            - $CI_COMMIT_MESSAGE  =~ /ci_build_whitelist/    only:            changes:            - BESMod/**/*    retry:        max: 2        when: runner_system_failure    when: on_failure    needs:    - job: Changed_Regressiontest_BESMod_Examples      artifacts: true    - job: Changed_Regressiontest_BESMod_Systems      artifacts: true    - job: Changed_Regressiontest_BESMod_Tutorial      artifacts: true    - job: Changed_Regressiontest_BESMod_Utilities      artifacts: trueRegressionTest_Check_References:    stage: Ref_Check    before_script:        - export PIP_CACHE_DIR="/opt/cache/pip"        - source activate myenv        - pip install --upgrade git+https://github.com/MichaMans/BuildingsPy@testexamplescoverage        - apt-get update -y && apt-get install xdg-utils --fix-missing -y        - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'        - export PYTHONIOENCODING=utf-8        - eval $(ssh-agent -s)        - mkdir -p ~/.ssh        - ssh-keyscan github.com >> ~/.ssh/known_hosts        - ssh-agent -a /tmp/ssh_agent.sock > /dev/null        - echo "$GITHUB_PRIVATE_KEY" > ~/.ssh/id_rsa        - chmod 600 ~/.ssh/id_rsa        - git config --global user.name "$GITLAB_USER_NAME"        - git config --global user.email "$GITLAB_USER_EMAIL"    script:        - mkdir CorrectedVersion && cd CorrectedVersion        - git clone --single-branch --branch $CI_COMMIT_REF_NAME git@github.com:$Github_Repository.git        - cd $CI_PROJECT_NAME        - git clone https://github.com/RWTH-EBC/MoCITempGen        - python MoCITempGen/CITests/CI_Configuration/configuration.py --create-ref        - cd BESMod && xvfb-run -n 77 python MoCITempGen/CITests/UnitTests/reference_check.py --create-ref -DS 2022  -n 4 < ../dymola-ci-tests/Configfiles/EOF.sh    after_script:        - export PIP_CACHE_DIR="/opt/cache/pip"        - source activate myenv        - export PYTHONIOENCODING=utf-8        - cd CorrectedVersion && cd $CI_PROJECT_NAME        - if cat dymola-ci-tests/Configfiles/exit.sh | grep "FAIL"; then            push_model=$(git ls-files --others --exclude-standard --directory BESMod) ;            echo $push_model ;            (git ls-files --others --exclude-standard --directory BESMod) > dymola-ci-tests/Configfiles/ci_new_created_reference.txt ;            message="CI message from ebc-aixlib-bot. Automatic push of CI with new regression reference files.Please pull the new files before push again. Plottet Results $GITLAB_Page/$CI_COMMIT_REF_NAME/plots/" ;            pip install pandas mako matplot;            python MoCITempGen/CITests/Converter/google_charts.py --line-html --new-ref --single-package BESMod ;            mkdir -p ../../$CI_COMMIT_REF_NAME/plots ;            mkdir -p ../../data ;            mkdir -p ../../data/reference_result ;            cp -r $(git ls-files --others --exclude-standard --directory BESMod) ../../data/reference_result  ;            cp -r BESMod/simulator-dymola.log ../../data ;            cp -r BESMod/unitTests-dymola.log ../../data ;            cp -r BESMod/funnel_comp ../../data ;            cp -r dymola-ci-tests/charts/* ../../$CI_COMMIT_REF_NAME/plots ;            git add $push_model ;            git commit -m "$message";            git push git@github.com:$Github_Repository.git ;            exit 1 ;          else            exit 0 ;          fi    artifacts:        when: on_failure        paths:            - data            - $CI_COMMIT_REF_NAME/plots        expire_in: 7h    except:        refs:            - None_Merge            - main        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_show_ref/            - $CI_COMMIT_MESSAGE  =~ /ci_create_model_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_html_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_create_example_wh/            - $CI_COMMIT_MESSAGE  =~ /ci_simulate/            - $CI_COMMIT_MESSAGE  =~ /ci_check/            - $CI_COMMIT_MESSAGE  =~ /ci_regression_test/            - $CI_COMMIT_MESSAGE  =~ /ci_html/            - $CI_COMMIT_MESSAGE  =~ /ci_setting/            - $CI_COMMIT_MESSAGE  =~ /ci_style_check/            - $CI_COMMIT_MESSAGE  =~ /ci_trigger_ibpsa/            - $CI_COMMIT_MESSAGE  =~ /ci_merge_except/            - $CI_COMMIT_MESSAGE  =~ /ci_correct_html/            - $CI_COMMIT_MESSAGE  =~ /ci_build_structure/            - $CI_COMMIT_MESSAGE  =~ /ci_build_whitelist/    only:        - external_pull_requestsplot_reference_results:    stage: plot_ref    before_script:        - source activate myenv        - pip install --upgrade pip &&  apt-get update -y && apt-get install zip unzip -y        - pip install pandas mako matplot toml requests        - export PYTHONIOENCODING=utf-8        - git clone https://github.com/RWTH-EBC/MoCITempGen    script:        - mkdir -p $CI_COMMIT_REF_NAME/plots        - python MoCITempGen/CITests/Converter/google_charts.py --line-html --show-ref --single-package BESMod --library BESMod        - cp -r dymola-ci-tests/charts/* $CI_COMMIT_REF_NAME/plots        - python MoCITempGen/CITests/api_script/api_github.py --working-branch $CI_COMMIT_REF_NAME --github-repo $Github_Repository --gitlab-page $GITLAB_Page --github-token $GITHUB_API_TOKEN --post-pr-comment --show-plot    artifacts:        when: always        paths:            - $CI_COMMIT_REF_NAME/plots    only:        variables:            - $CI_COMMIT_MESSAGE  =~ /ci_show_ref/        refs:            - external_pull_requests